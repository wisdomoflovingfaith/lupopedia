# Doctrine Corrections - Version 4.1.15

**Date:** 2026-01-20
**Script:** `database/migrations/craftysyntax_to_lupopedia_mysql.sql`
**Purpose:** Fix doctrine violations identified during migration audit

## Corrections Applied

### 1. Timestamp Doctrine Compliance
- **Issue:** Multiple instances of `0 AS created_ymdhis` or `0 AS updated_ymdhis`
- **Fix:** Replaced with `DATE_FORMAT(UTC_TIMESTAMP(), '%Y%m%d%H%i%S')`
- **Doctrine:** All timestamps must be UTC YYYYMMDDHHMMSS format

**Locations Fixed:**
- `lupo_crafty_syntax_layer_invites`
- `lupo_crm_leads` (updated_ymdhis only)
- `lupo_crafty_syntax_leave_message` (updated_ymdhis only)
- `lupo_actor_departments`

### 2. NOW() â†’ UTC_TIMESTAMP()
- **Issue:** `DATE_FORMAT(NOW(), '%Y%m%d%H%i%S')` in lupo_crm_lead_messages INSERT
- **Fix:** Changed to `DATE_FORMAT(UTC_TIMESTAMP(), '%Y%m%d%H%i%S')`
- **Doctrine:** System operates on UTC timezone

### 3. Column Mismatch Fix
- **Issue:** Invalid column `1` in lupo_crm_lead_messages INSERT column list
- **Fix:** Removed `1`, replaced with `actor_id`, updated SELECT accordingly
- **Doctrine:** Column counts and names must match between INSERT and SELECT

### 4. Migration Clarification
- **Issue:** `livehelp_emailque` documented as migrating but no INSERT present
- **Fix:** Updated comment to clarify as intentionally not migrated in this script

### 5. Typographical Corrections
- **Issue:** "remnoved" typo in four section headers
- **Fix:** Corrected to "removed"
- **Doctrine:** Documentation accuracy matters
