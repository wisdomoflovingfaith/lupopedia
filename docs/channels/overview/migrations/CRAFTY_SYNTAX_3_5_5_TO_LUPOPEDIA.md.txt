Crafty Syntax 3.7.5 ‚Üí Lupopedia Migration Atlas
This document provides a complete, table‚Äëby‚Äëtable mapping of how data from Crafty Syntax 3.7.5 is imported into the Lupopedia Semantic OS during the upgrade process.
It serves as the authoritative reference for understanding:

which Crafty Syntax tables are consumed

where each field‚Äôs data is moved inside Lupopedia

which tables are merged, split, transformed, or discarded

how legacy behaviors map to modern Lupopedia subsystems

which Crafty Syntax tables are dropped after migration

This is not a schema‚Äëpreservation migration.
It is a one‚Äëway data import followed by the removal of all 34 legacy Crafty Syntax tables.

The goal of this atlas is to give contributors, maintainers, and future agents a clear, durable understanding of how Crafty Syntax‚Äôs historical data model is translated into Lupopedia‚Äôs modern, prefix‚Äënormalized, doctrine‚Äëaligned architecture.

Each section documents:

Source table (Crafty Syntax 3.7.5)

Destination table(s) (Lupopedia)

Field‚Äëlevel mappings

Dropped or transformed fields

Behavioral notes

Migration considerations

### Table: livehelp_autoinvite
Source: livehelp_autoinvite (Crafty Syntax 3.7.5)
Status: Dropped after migration

Destination
Primary target table: lupo_crafty_syntax_auto_invite  
This is the Lupopedia‚Äënormalized replacement for Crafty Syntax‚Äôs auto‚Äëinvite rules.

Field Mapping
Crafty Syntax Column	Lupopedia Column	Notes
idnum	crafty_syntax_auto_invite_id	Primary key preserved exactly
offline	is_offline	Direct copy
isactive (Y/N)	is_active (1/0)	Boolean normalization
department	department_id	Direct copy
message	message	Direct copy
page	page_url	Renamed for clarity
visits	visits	Direct copy
referer	referrer_url	Corrected spelling + rename
typeof	invite_type	Direct copy
seconds	trigger_seconds	Direct copy
user_id	operator_user_id	Direct copy
socialpane (Y/N)	show_socialpane (1/0)	Boolean normalization
excludemobile (Y/N)	exclude_mobile (1/0)	Boolean normalization
onlymobile (Y/N)	only_mobile (1/0)	Boolean normalization
(no source)	created_ymdhis	Set to 20250101000000
(no source)	updated_ymdhis	Set to 20250101000000
(no source)	is_deleted	Always 0
(no source)	deleted_ymdhis	Always NULL
Behavioral Notes
Crafty Syntax stored auto‚Äëinvite rules in a single table with mixed semantics and Y/N booleans.

Lupopedia stores these rules in a normalized, prefix‚Äëscoped table with explicit boolean integers and consistent naming.

The migration preserves all functional behavior but modernizes the schema and naming conventions.

Migration SQL Summary
The migration performs three steps:

Normalize engine + charset  
Ensures the legacy table is readable and consistent before extraction.

Mark the table as deprecated  
Adds a comment clarifying that it is migration‚Äëonly.

Copy all rows into lupo_crafty_syntax_auto_invite  
Performs field renames, boolean conversions, and timestamp initialization.

After successful migration, livehelp_autoinvite is dropped along with the other 33 Crafty Syntax tables.


### What livehelp_channels used to be
In Crafty Syntax:

A channel was ephemeral

It existed only while an operator was online

All visitors currently talking to that operator were grouped into that temporary channel

When the operator logged off, the channel was deleted

This table was always empty between sessions

It was essentially a runtime container, not a durable entity

This matched the old ‚Äúlive chat‚Äù model:
operator online = channel exists  
operator offline = channel gone

### What lupo_channels is now in Lupopedia
Lupopedia‚Äôs architecture is fundamentally different:

A channel is context, not presence

A channel persists indefinitely

Actors (humans, agents, Hermes, etc.) can join or leave at any time

Channels represent semantic spaces, not operator sessions

They store:

intent

routing mode

emotional metadata

visibility rules

dialog history

agent membership

doctrine context

This is why:

livehelp_channels is obsolete and should remain empty.
lupo_channels is the correct permanent table.
You‚Äôve already made the correct architectural migration.

### livehelp_channels ‚Üí lupo_channels (DEPRECATED ‚Üí PERSISTENT CONTEXT)

**Legacy Behavior (Crafty Syntax)**  
`livehelp_channels` stored *ephemeral* operator chat channels.  
A channel was created only while an operator was online, and all active visitors were grouped into that temporary channel.  
When the operator logged off, the channel was deleted.  
This table was always empty between sessions.

**Lupopedia Behavior**  
Lupopedia replaces this with `lupo_channels`, which stores *persistent semantic channels* used for context, routing, multi‚Äëagent collaboration, and long‚Äëterm conversation history.  
Channels no longer depend on operator presence and are never auto‚Äëdeleted.

**Migration Action**  
No data is migrated from `livehelp_channels` because the table is intentionally empty and obsolete.  
The table is marked as deprecated and excluded from future schema generations.

**Post‚ÄëMigration Status**  
`livehelp_channels` remains empty and unused.  
`lupo_channels` is the canonical channel table going forward.

üóÇÔ∏è Refactor: livehelp_departments ‚Üí lupo_departments + lupo_department_metadata
Source Table
Crafty Syntax 3.7.5: livehelp_departments  
Status: Migrated ‚Üí Dropped after successful import

Crafty Syntax departments were simple routing buckets with a mixture of:

operator grouping

UI/theme settings

behavior flags

email settings

color schemes

language preferences

‚Äúwhile waiting‚Äù text

images and layout values

The table combined semantic meaning and UI configuration, which must be separated in Lupopedia.

Destination Tables (Lupopedia)
1. lupo_departments (semantic core)
Stores the meaning of a department:

department_id

federation_node_id

name

description

department_type

default_actor_id

settings_json

timestamps

soft‚Äëdelete flags

2. lupo_department_metadata (legacy UI + behavior)
Stores all Crafty Syntax UI/theme/behavior fields in a single JSON blob:

images

colors

layout

email flags

smiley settings

language

‚Äúwhile waiting‚Äù text

theme

timestamps

soft‚Äëdelete flags

This keeps the semantic table clean and doctrine‚Äëaligned.

Field‚ÄëLevel Mapping
livehelp_departments ‚Üí lupo_departments
Crafty Syntax Column	Lupopedia Column	Notes
recno	department_id	Primary key preserved exactly
website	federation_node_id	Installation ID from Crafty Syntax
nameof	name	Direct copy
(none)	description	NULL (Crafty Syntax had no description field)
(none)	department_type	Always 'crafty' for legacy imports
(none)	default_actor_id	Always 1 (Wolfie)
(none)	settings_json	NULL (all UI settings moved to metadata)
(none)	created_ymdhis	Set to migration timestamp
(none)	updated_ymdhis	Set to migration timestamp
(none)	is_deleted	Always 0
(none)	deleted_ymdhis	NULL
livehelp_departments ‚Üí lupo_department_metadata
All non‚Äësemantic Crafty Syntax fields are preserved in metadata_json:

onlineimage

offlineimage

layerinvite

requirename

messageemail

leaveamessage

opening

offline

creditline

imagemap

whilewait

timeout

topframeheight

topbackground

midbackground

botbackground

topbackcolor

midbackcolor

botbackcolor

colorscheme

speaklanguage

busymess

emailfun

dbfun

smiles

theme

showtimestamp

website

These values are stored exactly as they existed in Crafty Syntax.

Behavioral Notes
Legacy Behavior (Crafty Syntax)
Departments were simple operator routing groups.

UI/theme settings were stored directly in the same table.

No semantic meaning, no hierarchy, no metadata separation.

Operators were manually assigned to departments.

No persistent context or doctrine.

Lupopedia Behavior
Departments are semantic organizational units.

UI/theme/behavior settings belong in metadata, not the semantic table.

Departments can have:

hierarchy

routing rules

emotional metadata

agent membership

doctrine context

All legacy UI settings are preserved but isolated.

üóÇÔ∏è Refactor: livehelp_emailque + livehelp_emails
Source Tables
Crafty Syntax 3.7.5:

livehelp_emailque

livehelp_emails

Status: Migrated ‚Üí Dropped after successful import

These two tables formed the old Crafty Syntax ‚ÄúEmail the Entire Database‚Äù subsystem:

livehelp_emails stored the message content

livehelp_emailque stored the delivery log (who it was sent to, when, and status)

Lupopedia replaces this with:

lupo_crm_lead_messages (message content)

lupo_crm_lead_message_sends (delivery log)

Destination Tables (Lupopedia)
1. lupo_crm_lead_messages
Stores the content of outbound messages.

2. lupo_crm_lead_message_sends
Stores the delivery log for each message ‚Üí each lead.

(You already generated the JSON refactor for this table earlier.)

Field‚ÄëLevel Mapping
livehelp_emails ‚Üí lupo_crm_lead_messages
Crafty Syntax Column	Lupopedia Column	Notes
id	crm_lead_message_id	Primary key preserved exactly
fromemail	from_email	Direct copy
subject	subject	Direct copy
bodyof	body_text	Direct copy
notes	notes	Direct copy
(none)	lead_id	Always 1 (broadcast lead)
(none)	actor_id	NULL (legacy messages have no actor)
(none)	created_ymdhis	Migration timestamp
(none)	updated_ymdhis	Migration timestamp
livehelp_emailque ‚Üí lupo_crm_lead_message_sends
(This was completed earlier, but included here for completeness.)

Crafty Syntax Column	Lupopedia Column	Notes
id	crm_lead_message_send_id	Primary key preserved
messageid	crm_lead_message_id	FK‚Äëlike soft reference
email	lead_email	Direct copy
status	send_status	Direct copy
whensent	sent_ymdhis	Converted to YMDHIS
(none)	created_ymdhis	Migration timestamp
(none)	updated_ymdhis	Migration timestamp
Behavioral Notes
Legacy Behavior (Crafty Syntax)
livehelp_emails stored the broadcast email content.

livehelp_emailque stored one row per recipient, tracking delivery.

There was no lead_id, because Crafty Syntax treated all emails as ‚ÄúEmail the Entire Database.‚Äù

Lupopedia Behavior
All legacy broadcast emails are assigned to lead_id = 1, the special ‚Äúbroadcast lead.‚Äù

Message content and delivery logs are stored in separate, normalized tables.

Actor attribution is optional; legacy messages have actor_id = NULL.

Key Differences
Crafty Syntax had no concept of leads; Lupopedia requires one.

Crafty Syntax stored timestamps in mixed formats; Lupopedia uses YMDHIS.

Crafty Syntax had no semantic routing; Lupopedia does.

Table: livehelp_identity_daily / livehelp_identity_monthly
Source: Crafty Syntax 3.7.5
Status: Dropped (no migration)

Legacy Behavior
These tables stored a pre‚Äësession visitor identity system using:

IP address

user agent

cookie ID

identity string

username

groupidentity

groupusername

daily/monthly timestamps

seconds spent

number of visits

The archiveidentity() function attempted to stitch together anonymous visitors using whatever entropy was available.

This system existed because Crafty Syntax pre‚Äëdated:

reliable cookies

reliable sessions

modern analytics

device fingerprinting

federated identity

semantic actors

Lupopedia Behavior
Lupopedia replaces this entire subsystem with:

lupo_sessions

lupo_pageviews

lupo_visits_daily

lupo_visits_monthly

lupo_actor_identity_map

lupo_session_metadata

lupo_analytics_daily

lupo_analytics_monthly

Identity stitching is now handled by actors, sessions, and metadata ‚Äî not by daily/monthly identity tables.

Migration Action
No data is migrated.
No fields are preserved.
No JSON is created.
No mapping is required.

Both tables are dropped after migration.

Post‚ÄëMigration Status
livehelp_identity_daily ‚Üí removed

livehelp_identity_monthly ‚Üí removed

archiveidentity() ‚Üí deleted

All identity tracking handled by modern Lupopedia subsystems


## Table: livehelp_keywords_daily / livehelp_keywords_monthly
**Source:** Crafty Syntax 3.7.5  
**Status:** Dropped (no migration)

### Legacy Behavior
These tables attempted to extract ‚Äúkeywords‚Äù from visitor URLs using outdated assumptions such as `?q=` being the universal search parameter. This system predates modern analytics, UTM parameters, social media tracking, and AI assistant referrals.

### Lupopedia Behavior
Lupopedia replaces keyword tracking with a unified campaign variable system stored in `lupo_analytics_campaign_vars`. All query string variables are extracted, normalized, and stored as campaign keys and values.

### Migration Action
No data is migrated. Both tables are removed. All keyword logic is replaced with modern campaign variable extraction.

### Post-Migration Status
- livehelp_keywords_daily ‚Üí removed  
- livehelp_keywords_monthly ‚Üí removed  
- All analytics now use lupo_analytics_campaign_vars  


üóÇÔ∏è Refactor: livehelp_layerinvites ‚Üí lupo_crafty_syntax_layer_invites
Source Table
Crafty Syntax 3.7.5: livehelp_layerinvites  
Status: Migrated ‚Üí Dropped after successful import

This table stored the old DHTML floating image invites that appeared on the website to encourage visitors to open live chat. These were implemented using:

absolutely positioned GIF/PNG overlays

HTML imagemaps

JavaScript actions (openLiveHelp(), closeDHTML())

department name strings

optional operator ID

This system predates modern widgets and is preserved only for historical compatibility.

Destination Table (Lupopedia)
lupo_crafty_syntax_layer_invites
This table is the normalized, prefix‚Äëscoped replacement for the legacy layer invite system.

It preserves:

the image name

the imagemap

the department name (string only ‚Äî not an FK)

the operator ID (soft reference)

activation state

display/click counters

timestamps

soft‚Äëdelete flags

It does not preserve:

legacy JavaScript

legacy DHTML behavior

positioning logic

runtime invite triggers

Those are replaced by modern Lupopedia widgets.

Field‚ÄëLevel Mapping
Crafty Syntax Column	Lupopedia Column	Notes
name	layer_name	Direct copy
imagename	image_name	Direct copy
imagemap	image_map	Preserved exactly for compatibility
department	department_name	Legacy string; not an FK
user	user_id	Soft reference to operator ID
(none)	is_active	Always 1 on import
(none)	display_count	Initialized to 0
(none)	click_count	Initialized to 0
(none)	created_ymdhis	Migration timestamp
(none)	updated_ymdhis	Migration timestamp
(none)	is_deleted	Always 0
(none)	deleted_ymdhis	NULL
Behavioral Notes
Legacy Behavior (Crafty Syntax)
Layer invites were ephemeral UI elements.

They floated over the page using DHTML and absolute positioning.

Clicking them triggered openLiveHelp() JavaScript.

The department field stored a string, not a department ID.

The user field stored an operator ID, but inconsistently.

Imagemaps were stored as raw HTML.

No lifecycle fields existed.

Lupopedia Behavior
Layer invites are preserved only as historical artifacts.

They are stored in a normalized table for compatibility.

No JavaScript or DHTML behavior is regenerated.

Modern widgets replace all runtime invite logic.

Department names remain strings for historical accuracy.

Operator IDs remain soft references (no FK).

Lifecycle fields are added for consistency with Lupopedia doctrine.


üóÇÔ∏è Refactor: livehelp_leads ‚Üí lupo_crm_leads
Source Table
Crafty Syntax 3.7.5: livehelp_leads  
Status: Migrated ‚Üí Dropped after successful import

Crafty Syntax leads were a minimal contact form storage table, containing:

email

phone

first/last name

source

status

a free‚Äëform data field

a timestamp

There was no CRM logic, no scoring, no assignment, no lifecycle, no metadata, and no semantic structure.

Destination Table (Lupopedia)
lupo_crm_leads
This is the canonical CRM lead table in Lupopedia.

It supports:

semantic lead types

lead scoring

assignment to actors

JSON metadata

federation node IDs

lifecycle states

timestamps

soft‚Äëdelete flags

The migration preserves all Crafty Syntax data but modernizes the structure.

Field‚ÄëLevel Mapping
Crafty Syntax Column	Lupopedia Column	Notes
id	crm_lead_id	Primary key preserved exactly
email	email	Direct copy
phone	phone	Direct copy
firstname	first_name	Direct copy
lastname	last_name	Direct copy
source	source	Direct copy
status	status	Direct copy
(none)	lead_score	Always 0 for legacy leads
(none)	assigned_to	NULL (no assignment existed in Crafty Syntax)
data	lead_data	Stored as JSON/text exactly as provided
date_entered	created_ymdhis	Legacy timestamp preserved
(none)	updated_ymdhis	Migration timestamp
(none)	is_deleted	Always 0
(none)	deleted_ymdhis	NULL
Behavioral Notes
Legacy Behavior (Crafty Syntax)
Leads were created by the ‚ÄúLeave a Message‚Äù form.

No validation, no scoring, no assignment.

The data field contained arbitrary serialized text.

No lifecycle states existed.

No federation support.

No actor linkage.

No CRM pipeline.

Lupopedia Behavior
Leads are first‚Äëclass CRM entities.

They support:

scoring

assignment

lifecycle states

semantic source classification

JSON metadata

federation node IDs

actor relationships

Legacy leads are imported as ‚Äúbasic leads‚Äù with minimal structure.

Key Differences
Crafty Syntax leads were flat; Lupopedia leads are semantic.

Crafty Syntax stored arbitrary text; Lupopedia stores structured JSON.

Crafty Syntax had no scoring; Lupopedia initializes legacy leads with score 0.

Crafty Syntax had no assignment; Lupopedia leaves assigned_to NULL.

üóÇÔ∏è Refactor: livehelp_leavemessage ‚Üí lupo_crafty_syntax_leave_message
Source Table
Crafty Syntax 3.7.5: livehelp_leavemessage  
Status: Migrated ‚Üí Dropped after successful import

This table stored the old ‚ÄúLeave a Message‚Äù form submissions when no operator was online. It contained:

email

subject

department

session data

delimited form data

timestamp

no phone field

no name field

no IP or user agent

no lifecycle fields

It was a very early, minimal contact‚Äëform storage system.

Destination Table (Lupopedia)
lupo_crafty_syntax_leave_message
This is the normalized, doctrine‚Äëaligned replacement for the legacy leave‚Äëa‚Äëmessage system.

It preserves:

department ID

email

subject

session data

form data

timestamps

soft‚Äëdelete flags

assignment fields

status fields

It does not attempt to reconstruct missing fields (phone, name, message body, IP, user agent), because Crafty Syntax never stored them.

Field‚ÄëLevel Mapping
Crafty Syntax Column	Lupopedia Column	Notes
id	crafty_syntax_leave_message_id	Primary key preserved
department	department_id	Soft reference (no FK)
email	email	Direct copy
(none)	phone	Always NULL
(none)	name	Always NULL
subject	subject	Direct copy
(none)	message	Always NULL (Crafty Syntax did not store a message body)
(none)	priority	Always 2 (legacy default)
sessiondata	session_data	Direct copy
deliminated	form_data	Direct copy
(none)	ip_address	NULL (not stored in legacy)
(none)	user_agent	NULL (not stored in legacy)
(none)	status	'new'
(none)	assigned_to	NULL
dateof	created_ymdhis	Legacy timestamp preserved
(none)	updated_ymdhis	Migration timestamp
(none)	is_deleted	Always 0
(none)	deleted_ymdhis	NULL
Behavioral Notes
Legacy Behavior (Crafty Syntax)
This was the fallback when no operator was online.

The form was extremely minimal ‚Äî often just email + subject.

The ‚Äúmessage body‚Äù was never stored; instead, Crafty Syntax stored a delimited blob of form fields in deliminated.

No IP, no user agent, no phone, no name.

No lifecycle, no assignment, no status.

No semantic meaning.

Lupopedia Behavior
Leave‚Äëa‚Äëmessage entries are stored as first‚Äëclass CRM artifacts.

They support:

assignment

status

lifecycle

metadata

federation

Legacy fields are preserved exactly as they existed.

Missing fields remain NULL ‚Äî Lupopedia does not invent data.

Key Differences
Crafty Syntax stored raw form blobs; Lupopedia stores structured fields.

Crafty Syntax had no lifecycle; Lupopedia initializes with status = 'new'.

Crafty Syntax had no assignment; Lupopedia leaves assigned_to = NULL.

Crafty Syntax had no priority; Lupopedia assigns default priority 2.

üóÇÔ∏è Refactor: livehelp_messages ‚Üí lupo_dialog_threads + lupo_dialog_messages
Source Table
Crafty Syntax 3.7.5: livehelp_messages  
Status: Migrated ‚Üí Dropped after successful import

Crafty Syntax stored all chat messages in a flat table with:

no threads

no actors

no metadata

no message bodies beyond a short text field

ephemeral channels

no semantic meaning

This was enough for 2003 live chat, but not for a semantic OS.

Destination Tables (Lupopedia)
1. lupo_dialog_threads
One thread per legacy channel.

2. lupo_dialog_messages
Every Crafty Syntax message becomes a single row containing:

message ID

thread ID

actor

target actor

message type

timestamps

full body text

metadata JSON

lifecycle flags

No message_bodies table exists anymore.
Everything is unified.

Field‚ÄëLevel Mapping (Corrected)
livehelp_messages ‚Üí lupo_dialog_threads
Crafty Syntax Column	Lupopedia Column	Notes
channel	dialog_thread_id	One thread per channel
(none)	thread_type	'crafty'
MIN(timeof)	created_ymdhis	First message timestamp
MAX(timeof)	updated_ymdhis	Last message timestamp
(none)	is_deleted	0
(none)	deleted_ymdhis	NULL
livehelp_messages ‚Üí lupo_dialog_messages
Crafty Syntax Column	Lupopedia Column	Notes
id_num	dialog_message_id	Primary key preserved
channel	dialog_thread_id	Soft reference
saidfrom	actor_id	Legacy visitor/operator ID
saidto	target_actor_id	Legacy visitor/operator ID
typeof	message_type	Legacy message type
timeof	created_ymdhis	Direct copy
message	body_text	Stored directly in this table
(none)	metadata_json	Optional: store legacy flags
(none)	updated_ymdhis	Migration timestamp
(none)	is_deleted	0
(none)	deleted_ymdhis	NULL
Behavioral Notes
Legacy Behavior (Crafty Syntax)
Messages were stored in a single flat table.

Channels were ephemeral and tied to operator presence.

No threads, no actors, no metadata.

Message text was often truncated.

No concept of routing or semantic meaning.

Lupopedia Behavior
Every conversation is a thread.

Every message is a semantic dialog event.

body_text lives directly in lupo_dialog_messages.

No separate message body table exists.

Channels become persistent semantic threads.

Drop livehelp_modules and livehelp_modules_dep
Status
Dropped ‚Äî migration‚Äëonly tables, no longer part of Lupopedia.

Reason
Crafty Syntax used these tables to define:

legacy module definitions (livehelp_modules)

legacy module ‚Üí department visibility (livehelp_modules_dep)

Lupopedia replaces this entirely with:

lupo_modules ‚Äî canonical module registry

lupo_unified_registry ‚Äî global identity map

module_group_access ‚Äî modern visibility rules

lupo_groups ‚Äî department/group definitions

All module identity, visibility, and lifecycle information now lives in the modern tables.

No data from the legacy tables is needed after migration.

üü¶ Historical Notes
livehelp_modules
Stored module names and file paths for Crafty Syntax.

Not versioned, not documented, not federated.

Replaced by lupo_modules with proper lifecycle fields, federation, and doctrine.

livehelp_modules_dep
Mapped modules to departments.

Replaced by module_group_access, which uses:

unified registry IDs

group IDs

modern access rules


üü¶ REFACTOR ENTRY ‚Äî livehelp_operator_channels
Status
Dropped ‚Äî all functional meaning has been migrated.

Legacy Purpose (Crafty Syntax)
livehelp_operator_channels stored:

which operator was ‚Äúon‚Äù which channel

the channel ID

the visitor ID

the operator‚Äôs UI colors

the start timestamp

a status flag

a bunch of UI‚Äëonly color fields (bgcolor, txtcolor, channelcolor, txtcolor_alt)

This table existed solely to support the Crafty Syntax operator UI, where:

an operator could only be on one channel at a time

each thread had its own background color

channel 1 was the ‚Äúlobby‚Äù

threads were ephemeral and tied to operator presence

None of this maps to Lupopedia‚Äôs architecture.

üü¶ Modern Destination (Lupopedia)
‚úî Channel membership
Handled by:

lupo_channels

lupo_channel_membership

lupo_dialog_threads

Operators (actors) can be on multiple channels simultaneously.

‚úî Thread color information
Moved into:

lupo_dialog_threads.metadata_json

Example:

json
{
  "ui": {
    "bgcolor": "#F7FAFF",
    "txtcolor": "#000000",
    "channelcolor": "#F7FAFF",
    "txtcolor_alt": "#000000"
  }
}
‚úî Operator presence
Handled by:

lupo_actor_presence

lupo_channels

lupo_dialog_threads

‚úî Routing
Handled by:

lupo_routing_rules

lupo_channels

lupo_dialog_threads

‚úî Start timestamps
Already preserved in:

lupo_dialog_threads.created_ymdhis

üü¶ Rewrite Rules
json
{
  "drop_tables": [
    "livehelp_operator_channels"
  ],
  "rewrite_rules": {
    "color_fields": "moved to lupo_dialog_threads.metadata_json",
    "operator_presence": "handled by lupo_actor_presence and lupo_channels",
    "channel_assignment": "handled by lupo_channel_membership",
    "thread_context": "handled by lupo_dialog_threads"
  }

  REFACTOR ENTRY ‚Äî livehelp_operator_departments ‚Üí lupo_actor_departments
Legacy Purpose (Crafty Syntax)
livehelp_operator_departments was a simple mapping table:

recno ‚Äî primary key

user_id ‚Äî operator ID

department ‚Äî department ID

extra ‚Äî freeform text (title, label, or unused)

It represented which operators belonged to which departments.

No lifecycle fields, no federation, no metadata, no doctrine.

üü¶ Modern Destination (Lupopedia)
‚úî lupo_actor_departments
This is the correct semantic home for operator/actor ‚Üí department membership.

It includes:

actor_department_id

actor_id

department_id

title

lifecycle fields

federation‚Äësafe timestamps

Exactly what the legacy table was trying to express, but with proper structure.

üü¶ REFACTOR ENTRY ‚Äî livehelp_operator_history ‚Üí lupo_audit_log
Legacy Purpose (Crafty Syntax)
livehelp_operator_history recorded operator actions inside the old LiveHelp system:

opid ‚Äî operator ID

action ‚Äî what they did

dateof ‚Äî timestamp (already in YmdHis format!)

sessionid ‚Äî legacy session

transcriptid ‚Äî related chat transcript

totaltime ‚Äî duration

channel ‚Äî channel ID

This table was a crude audit log with no lifecycle fields, no metadata, no federation, and no semantic meaning.

üü¶ Modern Destination (Lupopedia)
‚úî lupo_audit_log
This is the correct semantic home for all historical operator actions.

It supports:

entity type

entity ID

event type

related table + ID

metadata JSON

lifecycle fields

federation

doctrine‚Äëaligned timestamps

Everything the legacy table was trying to express, but properly structured.

REFACTOR ENTRY ‚Äî livehelp_paths_firsts + livehelp_paths_monthly ‚Üí lupo_unified_analytics_paths
Legacy Purpose (Crafty Syntax)
livehelp_paths_firsts
Tracked first‚Äëtime transitions per month:

visit_recno ‚Üí from page

exit_recno ‚Üí to page

dateof (YYYYMM)

visits (count of first‚Äëtime transitions)

livehelp_paths_monthly
Tracked all transitions per month:

same fields as above

but counted every transition, not just first‚Äëtime ones

Both tables referenced the old pageurl table via recno IDs.

They were redundant, inconsistent, and required two separate queries to reconstruct navigation behavior.

üü¶ Modern Destination (Lupopedia)
‚úî lupo_unified_analytics_paths
A single, normalized table that stores:

path_id

from_page_id

to_page_id

year_month

transition_type (first, all)

transition_count

lifecycle fields

metadata JSON

This unifies both legacy tables into one semantic structure.


üß© Migration Step: livehelp_qa ‚Üí Truth Module + Navigation Collections (Idempotent Edition)
This step migrates the legacy Crafty Syntax Q&A system into Lupopedia‚Äôs modern Truth Module and Collections / Tabs navigation architecture.
It is fully idempotent and can be run repeatedly without side effects.

1. Normalize and Deprecate livehelp_qa
sql
ALTER TABLE livehelp_qa
    ENGINE=InnoDB,
    CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

ALTER TABLE livehelp_qa
  COMMENT = 'DEPRECATED: Only retained for migration. Safe to re-run. Not part of Lupopedia after 4.0.0.';
This ensures consistent encoding and marks the table as a migration artifact.

2. Migrate Questions ‚Üí lupo_truth_questions (Idempotent)
sql
INSERT INTO lupo_truth_questions (
    truth_question_id,
    truth_question_parent_id,
    actor_id,
    qtype,
    status,
    sort_num,
    slug,
    question_text,
    format,
    format_override,
    view_count,
    likes_count,
    shares_count,
    answer_count,
    last_activity_ymdhis,
    is_featured,
    is_verified,
    created_ymdhis,
    updated_ymdhis,
    is_deleted,
    deleted_ymdhis
)
SELECT
    recno,
    NULLIF(parent, 0),
    0,
    'unknown',
    'active',
    ordernum,
    CONCAT('qa-', recno),
    question,
    'text',
    NULL,
    0,
    0,
    0,
    0,
    NULL,
    0,
    0,
    20250101000000,
    20250101000000,
    0,
    NULL
FROM livehelp_qa
WHERE typeof = 'question'
AS new
ON DUPLICATE KEY UPDATE
    truth_question_parent_id = new.truth_question_parent_id,
    sort_num = new.sort_num,
    question_text = new.question_text,
    updated_ymdhis = new.updated_ymdhis;
This preserves parent/child relationships and ensures stable slugs.

3. Migrate Answers ‚Üí lupo_truth_answers (Idempotent)
sql
INSERT INTO lupo_truth_answers (
    truth_question_id,
    actor_id,
    answer_text,
    confidence_score,
    evidence_score,
    contradiction_flag,
    likes_count,
    shares_count,
    created_ymdhis,
    updated_ymdhis,
    is_deleted,
    deleted_ymdhis
)
SELECT
    parent,
    0,
    question,
    0.00,
    0.00,
    0,
    0,
    0,
    20250101000000,
    20250101000000,
    0,
    NULL
FROM livehelp_qa
WHERE typeof = 'answer'
AS new
ON DUPLICATE KEY UPDATE
    updated_ymdhis = new.updated_ymdhis;
Crafty Syntax stored answers in the same table as questions; Lupopedia separates them cleanly.

4. Create or Update the ‚ÄúSite Navigation‚Äù Collection
sql
INSERT INTO lupo_collections (
    federations_node_id,
    user_id,
    group_id,
    name,
    slug,
    color,
    description,
    sort_order,
    properties,
    published_ymdhis,
    created_ymdhis,
    updated_ymdhis,
    is_deleted,
    deleted_ymdhis
)
VALUES (
    1,
    NULL,
    NULL,
    'Site Navigation',
    'site-navigation',
    '666666',
    'Auto-generated navigation collection from Crafty Syntax',
    0,
    NULL,
    NULL,
    20250101000000,
    20250101000000,
    0,
    NULL
)
ON DUPLICATE KEY UPDATE
    updated_ymdhis = VALUES(updated_ymdhis);
Capture the collection ID:
sql
SET @nav_collection_id = (
    SELECT collection_id
    FROM lupo_collections
    WHERE slug = 'site-navigation'
    LIMIT 1
);
5. Migrate Top-Level Folders ‚Üí Root Tabs (Idempotent)
sql
INSERT INTO lupo_collection_tabs (
    collection_tab_parent_id,
    collection_id,
    federations_node_id,
    group_id,
    user_id,
    sort_order,
    name,
    slug,
    color,
    description,
    is_hidden,
    created_ymdhis,
    updated_ymdhis,
    is_active,
    is_deleted,
    deleted_ymdhis
)
SELECT
    NULL,
    @nav_collection_id,
    1,
    NULL,
    NULL,
    ordernum,
    question,
    LOWER(REPLACE(question, ' ', '-')),
    '4caf50',
    NULL,
    0,
    20250101000000,
    20250101000000,
    1,
    0,
    NULL
FROM livehelp_qa
WHERE typeof = 'folder' AND parent = 0
AS new
ON DUPLICATE KEY UPDATE
    sort_order = new.sort_order,
    updated_ymdhis = new.updated_ymdhis;
6. Migrate Child Folders ‚Üí Nested Tabs (Idempotent)
sql
INSERT INTO lupo_collection_tabs (
    collection_tab_parent_id,
    collection_id,
    federations_node_id,
    group_id,
    user_id,
    sort_order,
    name,
    slug,
    color,
    description,
    is_hidden,
    created_ymdhis,
    updated_ymdhis,
    is_active,
    is_deleted,
    deleted_ymdhis
)
SELECT
    parent_tab.collection_tab_id,
    @nav_collection_id,
    1,
    NULL,
    NULL,
    child.ordernum,
    child.question,
    LOWER(REPLACE(child.question, ' ', '-')),
    '4caf50',
    NULL,
    0,
    20250101000000,
    20250101000000,
    1,
    0,
    NULL
FROM livehelp_qa child
JOIN livehelp_qa parent
    ON parent.recno = child.parent
JOIN lupo_collection_tabs parent_tab
    ON parent_tab.slug = LOWER(REPLACE(parent.question, ' ', '-'))
WHERE child.typeof = 'folder' AND child.parent != 0
AS new
ON DUPLICATE KEY UPDATE
    sort_order = new.sort_order,
    updated_ymdhis = new.updated_ymdhis;


Migration Step: livehelp_questions ‚Üí lupo_crafty_syntax_chat_questions
(Pre‚ÄëChat Intake Questions)

The livehelp_questions table in Crafty Syntax stored the fields shown to the user before a chat session begins ‚Äî name, email, department selector, custom fields, etc.

These are not truth questions and must not be migrated into the Truth module.

They map directly into Lupopedia‚Äôs:

Code
lupo_crafty_syntax_chat_questions
This table preserves the legacy intake form structure for compatibility and historical reference.

1. Normalize and Deprecate livehelp_questions
sql
ALTER TABLE livehelp_questions
    ENGINE=InnoDB,
    CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

ALTER TABLE livehelp_questions
  COMMENT = 'DEPRECATED: Only retained for migration. Safe to re-run. Not part of Lupopedia after 4.0.0.';
2. Idempotent Migration Into lupo_crafty_syntax_chat_questions
sql
INSERT INTO lupo_crafty_syntax_chat_questions (
    crafty_syntax_chat_question_id,
    department_id,
    sort_order,
    headertext,
    field_type,
    options,
    flags,
    module_name,
    is_required,
    created_ymdhis,
    updated_ymdhis,
    is_deleted,
    deleted_ymdhis
)
SELECT
    id,
    department,
    ordering,
    headertext,
    fieldtype,
    options,
    flags,
    module,
    CASE WHEN required = 'Y' THEN 1 ELSE 0 END,
    20250101000000,
    20250101000000,
    0,
    NULL
FROM livehelp_questions
AS new
ON DUPLICATE KEY UPDATE
    department_id = new.department_id,
    sort_order = new.sort_order,
    headertext = new.headertext,
    field_type = new.field_type,
    options = new.options,
    flags = new.flags,
    module_name = new.module_name,
    is_required = new.is_required,
    updated_ymdhis = new.updated_ymdhis;


    ALTER TABLE livehelp_quick
    ENGINE=InnoDB,
    CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
ALTER TABLE livehelp_quick
  COMMENT = 'DEPRECATED: Only retained for migration. If something fails and you need to re-run the conversion, this table may be referenced. This table is NOT part of Lupopedia/Crafty Syntax as of version 4.0.0 and should be deleted after successful migration.';

INSERT INTO lupo_actor_reply_templates (
    actor_reply_template_id,
    actor_id,
    template_key,
    template_text,
    usage_context,
    created_ymdhis,
    updated_ymdhis,
    is_deleted,
    deleted_ymdhis
)
SELECT
    id AS actor_reply_template_id,
    `user` AS actor_id,
    name AS template_key,
    message AS template_text,
    typeof AS usage_context,
    20250101000000 AS created_ymdhis,
    20250101000000 AS updated_ymdhis,
    0 AS is_deleted,
    NULL AS deleted_ymdhis
FROM livehelp_quick;



üß© Migration Step: livehelp_smilies ‚Üí Dropped
(Replaced by the Lupopedia Emoji Token System)
The legacy livehelp_smilies table stored mappings from Crafty Syntax text tokens (e.g., :shock:) to image filenames (e.g., icon_eek.gif).
This table is not migrated into Lupopedia.

Lupopedia replaces the entire smilie‚Äëmapping subsystem with a filesystem‚Äëbased emoji picker and a safe, explicit markup token.

The result is:

no database table

no lookup mappings

no ambiguity

no HTML embedded in chat text

full support for custom emoji packs

automatic folder‚Äëbased discovery

1. Drop / Deprecate livehelp_smilies
sql
ALTER TABLE livehelp_smilies
  COMMENT = 'DEPRECATED: Dropped during migration. Crafty Syntax smilie mappings are not used in Lupopedia. Emoji rendering is now filesystem-based and token-driven.';
(Table is removed entirely during post‚Äëmigration cleanup.)

üåü 2. The Lupopedia Emoji System (Replacement Architecture)
Lupopedia uses a folder‚Äëbased, self‚Äëdiscovering, zero‚Äëmaintenance emoji system.

Directory structure:
Code
smilies/
    default/
    animals/
    reactions/
    custom/
Each subfolder becomes a tab in the emoji picker.
Each image becomes a selectable emoji.

No database.
No migrations.
No schema drift.
No FK chains.
No brittle HTML.

3. Emoji Token Format (Canonical)
Lupopedia inserts a safe, reversible, unambiguous token into chat text:

Code
||emoji:smilies/default/icon_eek.gif||
Why this format:
|| is already part of Lupopedia‚Äôs markup ecosystem

emoji: is a clear namespace

the path is explicit and portable

no HTML inside chat text

no escaping issues

easy to regex

easy to render

easy to extend

4. Renderer Rules
When the renderer encounters:

Code
||emoji:PATH/TO/FILE||
‚Ä¶it outputs:

html
<img src="PATH/TO/FILE" class="emoji">
Renderer responsibilities:

sanitize the path

ensure the file exists

apply the .emoji class

support theme‚Äëaware sizing

support accessibility (alt text optional)

5. UI Behavior
When the user clicks the emoji icon:

Lupopedia scans the smilies/ directory

Each subfolder becomes a tab

Each image becomes a selectable emoji

Clicking an emoji inserts the token:

Code
||emoji:smilies/<folder>/<filename>||
The chat preview renders the actual image

The stored message keeps the token (not HTML)

This ensures:

portability

reversibility

safety

future‚Äëproofing

custom emoji pack support

6. Doctrine Notes
A. No HTML in chat text
HTML is brittle, unsafe, and not reversible.

B. No database mapping tables
Emoji packs are filesystem‚Äëdriven, not schema‚Äëdriven.

C. Tokens must be explicit and namespaced
||emoji:...|| prevents collisions with other markup.

D. Emoji system must be self‚Äëdiscovering
Adding a new emoji = drop a file into a folder.

E. Renderer must be deterministic and safe
Token ‚Üí sanitized path ‚Üí <img>.


üß© Migration Step: livehelp_sessions ‚Üí Dropped
(Replaced by lupo_sessions, the deterministic, actor‚Äëaware session engine)
The legacy livehelp_sessions table stored Crafty Syntax‚Äôs ephemeral visitor sessions.
These sessions were:

non‚Äëdeterministic

browser‚Äëcookie dependent

not actor‚Äëaware

not device‚Äëaware

not federated

not repairable

not timestamp‚Äënormalized

not suitable for multi‚Äëagent systems

Lupopedia replaces this subsystem entirely with:

Code
lupo_sessions
‚Ä¶a deterministic, actor‚Äëaware, device‚Äëaware, federated‚Äëready, repairable session engine that supports:

multi‚Äëagent concurrency

cross‚Äëdevice continuity

temporal intelligence

session replay

emotional context tracking

safe migration and regeneration

Because of this, no data from livehelp_sessions is migrated.

The table is retained only long enough to allow safe re‚Äëruns of the migration process.


