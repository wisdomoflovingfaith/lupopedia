---
wolfie.headers: explicit architecture with structured clarity for every file.
file.last_modified_system_version: 4.0.14
header_atoms:
  - GLOBAL_CURRENT_LUPOPEDIA_VERSION
  - GLOBAL_CURRENT_AUTHORS
dialog:
  speaker: KIRO
  target: @everyone
  mood_RGB: "0066FF"
  message: "Updated INLINE_DIALOG_SPECIFICATION.md for Phase 2: Updated to version 4.0.14, enhanced cross-references, and ensured consistency with dialog doctrine and metadata governance."
tags:
  categories: ["documentation", "specification", "multi-agent"]
  collections: ["core-docs"]
  channels: ["dev"]
in_this_file_we_have:
  - Inline Dialog Specification (Formal Standard)
  - Two Types of Dialog Usage (Header vs Inline)
  - Canonical YAML Format
  - Field Definitions and Requirements
  - Behavioral Requirements for IDE Agents
  - Database Logging Requirements
  - Implementation Examples
  - Enforcement Rules
file:
  title: "Inline Dialog Specification"
  description: "Required communication format for all AI agents and IDE systems working on Lupopedia"
  version: GLOBAL_CURRENT_LUPOPEDIA_VERSION
  status: published
  author: GLOBAL_CURRENT_AUTHORS
---

# ðŸ“˜ Inline Dialog Specification (Formal Standard v1.1)

## 1. Purpose  
Inline Dialog is a structured communication format used by all AI agents, IDEs, and automated systems working on Lupopedia. There are **two distinct uses** of dialog format:

1. **Wolfie Header Dialog** (top of file) - Represents the latest edit/modification to the file
2. **Inline Dialogs** (anywhere in file) - Margin notes, comments, observations that do NOT modify file logic

Both use the same format but serve different purposes:
- **Header dialog** = Latest edit snapshot (updated only when file is modified)
- **Inline dialogs** = Agent notes/comments (can be added anytime, do not change file content)

---

## 2. Format Overview  

Both header dialogs and inline dialogs use the same YAML format, delimited by `---` before and after.

### **Canonical Format**
```yaml
---
DIALOG:
  speaker: <STRING>
  target: <STRING>
  message: <STRING, max 272 chars>
  date_ymdhis: <YYYYMMDDHHMMSS> (optional, auto-generated if missing)
  mood_RGB: <RRGGBB> (optional, Counting-in-Light mood color)
---
```

**Note:** In WOLFIE Headers, the dialog block uses `dialog:` as the key. In standalone inline dialogs, use `DIALOG:` as shown above.

---

## 3. Field Definitions

### **3.1 `speaker` (required)**  
- Type: string  
- Meaning: The agent, IDE, or human generating the dialog.  
- Examples: `CAPTAIN_WOLFIE`, `CURSOR`, `DEEPSEEK`, `COPILOT`, `PHP_AGENT`, `LILITH`, `THOTH`, `CARMEN`, `WOLFIE`

### **3.2 `target` (required)**  
- Type: string  
- Meaning: The intended recipient(s) of the dialog.  
- Allowed formats:  
  - `@everyone`  
  - `@<agent>`  
  - `@<subsystem>`  

### **3.3 `message` (required)**  
- Type: string  
- Max length: **272 characters**  
- Meaning: 
  - For header dialogs: What the agent did when modifying the file
  - For inline dialogs: A note, question, observation, warning, or suggestion
- Must be plain text.

### **3.4 `date_ymdhis` (optional)**  
- Type: string (YYYYMMDDHHMMSS format)  
- Meaning: Timestamp of when the dialog was created  
- Default: Auto-generated by system if not provided

### **3.5 `mood_RGB` (optional)**  
- Type: string (6-character hex color: RRGGBB)  
- Meaning: Counting-in-Light mood color for the dialog  
- Format: 6 hex digits (e.g., `666666`, `FF0000`, `00FF00`)

---

## 4. Two Types of Dialog Usage

### **4.1 Wolfie Header Dialog (Top of File)**
- Located in the WOLFIE Header at the top of the file
- Represents the **latest edit/modification** to the file
- **Updated ONLY when the file itself is modified**
- Uses `dialog:` key in the header YAML block
- See [WOLFIE Header Specification](../../agents/WOLFIE_HEADER_SPECIFICATION.md) for complete details

### **4.2 Inline Dialogs (Inside File)**
- Can appear **anywhere inside a file** (not just at the top)
- Used for: contrasting ideas, questions, observations, clarifications, warnings, alternative interpretations, suggestions for future edits
- **DO NOT modify the file's logic or content**
- Behave like margin notes or comments
- Use `DIALOG:` key in standalone YAML blocks
- Can be added by agents when reading files (to comment on specific sections)
- Multiple inline dialogs allowed per file

### **Placement Examples**

**Header Dialog (in WOLFIE Header):**
```yaml
---
wolfie.headers.version: 4.0.1
dialog:
  speaker: CURSOR
  target: @everyone
  message: "Updated this file to clarify inline dialog behavior."
---
```

**Inline Dialog (inside file content):**
```markdown
## Section About Database

Some content here explaining database design.

---
DIALOG:
  speaker: LILITH
  target: @everyone
  message: "Question: Should we document the migration path from domain_id to node_id here?"
  date_ymdhis: 20260106120000
---

More content continues...
```  

---

## 5. Behavioral Requirements for IDE Agents

### **5.1 When Reading a File**
Agents MAY:
- Add inline dialogs to comment on specific lines or sections
- Leave observations, questions, or warnings as inline dialogs

Agents MUST NOT:
- Overwrite existing inline dialogs
- Update the Wolfie Header dialog unless modifying the file itself

### **5.2 When Writing/Modifying a File**
Agents MUST:
- Update the Wolfie Header dialog block (if file is being modified)
- Set the dialog message to reflect what was changed

Agents MAY:
- Add inline dialogs if leaving notes for other agents
- Add inline dialogs to explain reasoning or raise questions

### **5.3 When Creating a File**
Agents MUST:
- Include a WOLFIE Header with `wolfie.headers.version: 4.0.1`
- Include a `dialog:` block in the header with the initial message

Agents MAY:
- Include inline dialogs in the initial file content

### **5.4 Message Length Enforcement**  
`message` MUST NOT exceed **272 characters**.

### **5.5 Multi-Agent Awareness**  
All agents MUST assume:

- they are not the only system working  
- other agents may act on the same files  
- dialog blocks are the authoritative coordination mechanism
- existing inline dialogs must be preserved (they are comments, not code)  

---

## 6. Database Logging Requirements

**CRITICAL:** All dialogs (both header dialogs and inline dialogs) MUST be logged in the `dialog_messages` table.

### **6.1 Header Dialog Logging**
When a file is modified and the header dialog is updated:
1. Extract the **previous** header dialog (if exists)
2. Insert it into `dialog_messages` table (preserves history)
3. Update the header with the new dialog
4. Insert the new dialog into `dialog_messages` table

### **6.2 Inline Dialog Logging**
When an inline dialog is added:
1. Insert it immediately into `dialog_messages` table
2. Leave the inline dialog in the file (it's a comment/note)

### **6.3 Database Storage Mapping**
When storing in `dialog_messages`:

- `speaker` â†’ `agent_name` field (stored as-is)  
- `target` â†’ `target` field (stored as-is)  
- `message` â†’ `message_text` field (stored verbatim)  
- `date_ymdhis` â†’ `created_ymdhis` field (if provided, otherwise auto-generated)
- `mood_RGB` â†’ `mood_rgb` field (if provided)
- `node_id` â†’ Inherited from context (defaults to 1 for local node)
- `dialog_threads_id` â†’ May be associated with a thread if applicable  

---

## 7. Examples

### **7.1 Header Dialog (in WOLFIE Header)**
```yaml
---
wolfie.headers.version: 4.0.1
dialog:
  speaker: CURSOR
  target: @everyone
  message: "Updated migration docs to match Lupopedia doctrine. No constraints added."
---
```

### **7.2 Inline Dialog (margin note in file)**
```markdown
Some content explaining database design principles.

---
DIALOG:
  speaker: LILITH
  target: @everyone
  message: "Edge case: What happens if domain_id exists but node_id is missing during migration?"
  date_ymdhis: 20260106120000
---

More content continues...
```

### **7.3 Inline Dialog (question about code)**
```php
function migrate_domain_to_node() {
    // Migration logic here
}

---
DIALOG:
  speaker: THOTH
  target: @CURSOR
  message: "Question: Should this function handle the case where domain_id = 0 maps to node_id = 1?"
  date_ymdhis: 20260106120500
---
```

### **7.4 Inline Dialog (alternative interpretation)**
```markdown
The system uses node_id for scoping.

---
DIALOG:
  speaker: CARMEN
  target: @everyone
  message: "Alternative view: Could we use context_id for scoping instead, keeping nodes for federation only?"
  date_ymdhis: 20260106121000
---
```

### **7.5 Multiple Inline Dialogs in One File**
```markdown
## Section 1

Content here.

---
DIALOG:
  speaker: WOLFIE
  target: @everyone
  message: "Note: This section needs examples added."
---

## Section 2

More content.

---
DIALOG:
  speaker: CURSOR
  target: @WOLFIE
  message: "Added examples as requested. Ready for review."
  date_ymdhis: 20260106121500
---
```

---

## 8. Versioning  
This is **Inline Dialog Specification v1.0**.  
Future versions may add optional fields (e.g., severity, tags) but MUST remain backwardâ€‘compatible.

---

## 9. Related Documentation

- **[DATABASE_SCHEMA.md](../../schema/DATABASE_SCHEMA.md)** â€” dialog_messages table structure and database storage
- **[WOLFIE_HEADER_SPECIFICATION.md](../../agents/WOLFIE_HEADER_SPECIFICATION.md)** â€” Header dialog format and metadata requirements
- **[AGENT_RUNTIME.md](../../agents/AGENT_RUNTIME.md)** â€” Complete guide to agent system runtime behavior
- **[Dialog Doctrine](../../doctrine/DIALOG_DOCTRINE.md)** â€” MANDATORY rules for dialog file placement, naming, and organization
- **[Database Philosophy](DATABASE_PHILOSOPHY.md)** â€” Contains Inline Dialog examples and multi-agent coordination notes
- **[Dialog Module](../modules/dialog/README.md)** â€” Database tables and PHP integration
- **[DIALOG.md](../modules/dialog/DIALOG.md)** â€” Temporary markdown fallback (being migrated to database)

---

## 10. Implementation Notes

### For PHP Agents:
```php
// Example PHP code to parse and store a dialog entry
function parseDialogBlock(string $yamlBlock): ?array {
    $parsed = yaml_parse($yamlBlock);
    if (!isset($parsed['DIALOG'])) {
        return null;
    }
    
    $dialog = $parsed['DIALOG'];
    return [
        'speaker' => $dialog['speaker'] ?? '',
        'target' => $dialog['target'] ?? '',
        'message' => substr($dialog['message'] ?? '', 0, 272),
    ];
}

function storeDialog(string $speaker, string $target, string $message, ?string $mood_rgb = null): void {
    // Ensure message is within length limit
    $message = substr($message, 0, 272);
    
    // Store in dialog_messages table
    $db->insert('dialog_messages', [
        'agent_name' => $speaker,
        'target' => $target,
        'message_text' => $message,
        'created_ymdhis' => date('YmdHis'),
        'node_id' => getCurrentNodeId(), // Use node_id, not domain_id
        'mood_rgb' => $mood_rgb ?? '666666',
        'message_type' => 'text',
        'is_broadcast' => ($target === '@everyone') ? 1 : 0
    ]);
}

function updateFileHeaderDialog(string $filePath, string $speaker, string $target, string $message): void {
    // Read file
    $content = file_get_contents($filePath);
    
    // Parse WOLFIE Header
    $header = parseWolfieHeader($content);
    
    // Archive previous dialog if exists
    if (isset($header['dialog'])) {
        storeDialog(
            $header['dialog']['speaker'],
            $header['dialog']['target'],
            $header['dialog']['message'],
            $header['dialog']['mood_RGB'] ?? null
        );
    }
    
    // Update header with new dialog
    $header['dialog'] = [
        'speaker' => $speaker,
        'target' => $target,
        'message' => substr($message, 0, 272)
    ];
    
    // Store new dialog
    storeDialog($speaker, $target, $message);
    
    // Write updated file
    $newContent = reconstructWolfieHeader($header) . getFileContentWithoutHeader($content);
    file_put_contents($filePath, $newContent);
}
```

---

## 11. Enforcement

All agents **MUST**:

1. âœ… Read this specification before generating documentation or SQL
2. âœ… Follow the Inline Dialog format exactly
3. âœ… Assume multi-agent collaboration at all times
4. âœ… Never assume they are the only system working on Lupopedia
5. âœ… Include dialog entries when making changes that affect other agents
6. âœ… Respect the 272-character limit
7. âœ… Use plain text (no markdown) inside dialog messages

---

## 8. Summary

**Key Distinctions:**

- **Wolfie Header Dialog** = Latest edit (file modification snapshot)
  - Located at top of file in WOLFIE Header
  - Updated ONLY when file is modified
  - Represents the change made to the file

- **Inline Dialogs** = Margin notes from agents
  - Can appear anywhere in the file
  - Do NOT modify file logic or content
  - Used for: questions, observations, warnings, suggestions
  - Multiple inline dialogs allowed per file

**Common Rules:**

- Both use the same dialog format (`speaker`, `target`, `message`, optional `date_ymdhis`, optional `mood_RGB`)
- Both MUST be logged in `dialog_messages` table
- Both have 272-character message limit
- Both preserve conversational lineage

**Behavior Rules:**

- **When reading**: May add inline dialogs, must NOT overwrite existing ones, must NOT update header unless modifying file
- **When writing**: Update header dialog, optionally add inline dialogs

---

## 9. Version History

- **v1.1.0** (2026-01-06): Clarified distinction between header dialogs and inline dialogs
  - Added separate sections for header vs inline dialogs
  - Clarified behavior rules for reading vs writing
  - Added database logging requirements
  - Added examples of inline dialogs as margin notes
  - Clarified that inline dialogs do not modify file logic

- **v1.0.0** (2026-01-05): Initial formal specification created
  - Defined canonical YAML format with `speaker`, `target`, `message` fields
  - Established 272-character message limit
  - Added placement rules and behavioral requirements
  - Integrated with dialog database storage
  - Added enforcement guidelines

---

**This specification is mandatory for all AI agents and IDE systems working on Lupopedia.**
